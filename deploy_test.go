package main

import (
	"testing"
)

func TestWatchDeploy(t *testing.T) {
	watchdeploy()
}

var a = `
deployType:  DELETED
json: {"metadata":{"name":"netshoot","generateName":"","namespace":"default","selfLink":"/apis/extensions/v1beta1/namespaces/default/deployments/netshoot","uid":"9f0f7cdd-56a4-11e9-8fd4-1e5e900bfc2b","resourceVersion":"68267585","generation":1,"creationTimestamp":"2019-04-04T14:41:05+08:00","labels":{"app":"netshoot"},"annotations":{"deployment.kubernetes.io/revision":"1","kubectl.kubernetes.io/last-applied-configuration":"{\"apiVersion\":\"apps/v1\",\"kind\":\"Deployment\",\"metadata\":{\"annotations\":{\"wechat\":\"wen\"},\"labels\":{\"app\":\"netshoot\"},\"name\":\"netshoot\",\"namespace\":\"default\"},\"spec\":{\"replicas\":1,\"selector\":{\"matchLabels\":{\"app\":\"netshoot\"}},\"template\":{\"metadata\":{\"labels\":{\"app\":\"netshoot\"}},\"spec\":{\"containers\":[{\"command\":[\"/bin/sh\",\"-c\",\"echo hello \\u003e\\u00262; echo hello1; sleep 100000\"],\"image\":\"nicolaka/netshoot\",\"name\":\"netshoot\"}],\"nodeSelector\":{\"func\":\"monitor\"},\"tolerations\":[{\"operator\":\"Exists\"}]}}}}\n","wechat":"wen"},"clusterName":""},"spec":{"replicas":1,"selector":{"matchLabels":{"app":"netshoot"}},"template":{"metadata":{"name":"","generateName":"","namespace":"","selfLink":"","uid":"","resourceVersion":"","generation":0,"creationTimestamp":"1970-01-01T08:00:00+08:00","labels":{"app":"netshoot"},"clusterName":""},"spec":{"containers":[{"name":"netshoot","image":"nicolaka/netshoot","command":["/bin/sh","-c","echo hello \u003e\u00262; echo hello1; sleep 100000"],"workingDir":"","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"Always","stdin":false,"stdinOnce":false,"tty":false}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirst","nodeSelector":{"func":"monitor"},"serviceAccountName":"","serviceAccount":"","nodeName":"","hostNetwork":false,"hostPID":false,"hostIPC":false,"securityContext":{},"hostname":"","subdomain":"","schedulerName":"default-scheduler","tolerations":[{"key":"","operator":"Exists","value":"","effect":""}],"priorityClassName":""}},"strategy":{"type":"RollingUpdate","rollingUpdate":{"maxUnavailable":{"type":1,"intVal":0,"strVal":"25%"},"maxSurge":{"type":1,"intVal":0,"strVal":"25%"}}},"minReadySeconds":0,"revisionHistoryLimit":10,"paused":false,"progressDeadlineSeconds":600},"status":{"observedGeneration":1,"replicas":1,"updatedReplicas":1,"readyReplicas":1,"availableReplicas":1,"unavailableReplicas":0,"conditions":[{"type":"Available","status":"True","lastUpdateTime":"2019-04-04T14:41:09+08:00","lastTransitionTime":"2019-04-04T14:41:09+08:00","reason":"MinimumReplicasAvailable","message":"Deployment has minimum availability."},{"type":"Progressing","status":"True","lastUpdateTime":"2019-04-04T14:41:09+08:00","lastTransitionTime":"2019-04-04T14:41:05+08:00","reason":"NewReplicaSetAvailable","message":"ReplicaSet \"netshoot-757c55d9b8\" has successfully progressed."}]}}


deployType:  ADDED
json: {"metadata":{"name":"netshoot","generateName":"","namespace":"default","selfLink":"/apis/extensions/v1beta1/namespaces/default/deployments/netshoot","uid":"e1058357-56a4-11e9-8fd4-1e5e900bfc2b","resourceVersion":"68267667","generation":1,"creationTimestamp":"2019-04-04T14:42:56+08:00","labels":{"app":"netshoot"},"annotations":{"kubectl.kubernetes.io/last-applied-configuration":"{\"apiVersion\":\"apps/v1\",\"kind\":\"Deployment\",\"metadata\":{\"annotations\":{\"wechat\":\"wen\"},\"labels\":{\"app\":\"netshoot\"},\"name\":\"netshoot\",\"namespace\":\"default\"},\"spec\":{\"replicas\":1,\"selector\":{\"matchLabels\":{\"app\":\"netshoot\"}},\"template\":{\"metadata\":{\"labels\":{\"app\":\"netshoot\"}},\"spec\":{\"containers\":[{\"command\":[\"/bin/sh\",\"-c\",\"echo hello \\u003e\\u00262; echo hello1; sleep 100000\"],\"image\":\"nicolaka/netshoot\",\"name\":\"netshoot\"}],\"nodeSelector\":{\"func\":\"monitor\"},\"tolerations\":[{\"operator\":\"Exists\"}]}}}}\n","wechat":"wen"},"clusterName":""},"spec":{"replicas":1,"selector":{"matchLabels":{"app":"netshoot"}},"template":{"metadata":{"name":"","generateName":"","namespace":"","selfLink":"","uid":"","resourceVersion":"","generation":0,"creationTimestamp":"1970-01-01T08:00:00+08:00","labels":{"app":"netshoot"},"clusterName":""},"spec":{"containers":[{"name":"netshoot","image":"nicolaka/netshoot","command":["/bin/sh","-c","echo hello \u003e\u00262; echo hello1; sleep 100000"],"workingDir":"","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"Always","stdin":false,"stdinOnce":false,"tty":false}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirst","nodeSelector":{"func":"monitor"},"serviceAccountName":"","serviceAccount":"","nodeName":"","hostNetwork":false,"hostPID":false,"hostIPC":false,"securityContext":{},"hostname":"","subdomain":"","schedulerName":"default-scheduler","tolerations":[{"key":"","operator":"Exists","value":"","effect":""}],"priorityClassName":""}},"strategy":{"type":"RollingUpdate","rollingUpdate":{"maxUnavailable":{"type":1,"intVal":0,"strVal":"25%"},"maxSurge":{"type":1,"intVal":0,"strVal":"25%"}}},"minReadySeconds":0,"revisionHistoryLimit":10,"paused":false,"progressDeadlineSeconds":600},"status":{"observedGeneration":0,"replicas":0,"updatedReplicas":0,"readyReplicas":0,"availableReplicas":0,"unavailableReplicas":0}}deployType:  MODIFIED
json: {"metadata":{"name":"netshoot","generateName":"","namespace":"default","selfLink":"/apis/extensions/v1beta1/namespaces/default/deployments/netshoot","uid":"e1058357-56a4-11e9-8fd4-1e5e900bfc2b","resourceVersion":"68267669","generation":1,"creationTimestamp":"2019-04-04T14:42:56+08:00","labels":{"app":"netshoot"},"annotations":{"deployment.kubernetes.io/revision":"1","kubectl.kubernetes.io/last-applied-configuration":"{\"apiVersion\":\"apps/v1\",\"kind\":\"Deployment\",\"metadata\":{\"annotations\":{\"wechat\":\"wen\"},\"labels\":{\"app\":\"netshoot\"},\"name\":\"netshoot\",\"namespace\":\"default\"},\"spec\":{\"replicas\":1,\"selector\":{\"matchLabels\":{\"app\":\"netshoot\"}},\"template\":{\"metadata\":{\"labels\":{\"app\":\"netshoot\"}},\"spec\":{\"containers\":[{\"command\":[\"/bin/sh\",\"-c\",\"echo hello \\u003e\\u00262; echo hello1; sleep 100000\"],\"image\":\"nicolaka/netshoot\",\"name\":\"netshoot\"}],\"nodeSelector\":{\"func\":\"monitor\"},\"tolerations\":[{\"operator\":\"Exists\"}]}}}}\n","wechat":"wen"},"clusterName":""},"spec":{"replicas":1,"selector":{"matchLabels":{"app":"netshoot"}},"template":{"metadata":{"name":"","generateName":"","namespace":"","selfLink":"","uid":"","resourceVersion":"","generation":0,"creationTimestamp":"1970-01-01T08:00:00+08:00","labels":{"app":"netshoot"},"clusterName":""},"spec":{"containers":[{"name":"netshoot","image":"nicolaka/netshoot","command":["/bin/sh","-c","echo hello \u003e\u00262; echo hello1; sleep 100000"],"workingDir":"","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"Always","stdin":false,"stdinOnce":false,"tty":false}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirst","nodeSelector":{"func":"monitor"},"serviceAccountName":"","serviceAccount":"","nodeName":"","hostNetwork":false,"hostPID":false,"hostIPC":false,"securityContext":{},"hostname":"","subdomain":"","schedulerName":"default-scheduler","tolerations":[{"key":"","operator":"Exists","value":"","effect":""}],"priorityClassName":""}},"strategy":{"type":"RollingUpdate","rollingUpdate":{"maxUnavailable":{"type":1,"intVal":0,"strVal":"25%"},"maxSurge":{"type":1,"intVal":0,"strVal":"25%"}}},"minReadySeconds":0,"revisionHistoryLimit":10,"paused":false,"progressDeadlineSeconds":600},"status":{"observedGeneration":0,"replicas":0,"updatedReplicas":0,"readyReplicas":0,"availableReplicas":0,"unavailableReplicas":0,"conditions":[{"type":"Progressing","status":"True","lastUpdateTime":"2019-04-04T14:42:56+08:00","lastTransitionTime":"2019-04-04T14:42:56+08:00","reason":"NewReplicaSetCreated","message":"Created new replica set \"netshoot-757c55d9b8\""}]}}2019/04/04 14:42:55 ignore normal event
deployType:  MODIFIED
json: {"metadata":{"name":"netshoot","generateName":"","namespace":"default","selfLink":"/apis/extensions/v1beta1/namespaces/default/deployments/netshoot","uid":"e1058357-56a4-11e9-8fd4-1e5e900bfc2b","resourceVersion":"68267672","generation":1,"creationTimestamp":"2019-04-04T14:42:56+08:00","labels":{"app":"netshoot"},"annotations":{"deployment.kubernetes.io/revision":"1","kubectl.kubernetes.io/last-applied-configuration":"{\"apiVersion\":\"apps/v1\",\"kind\":\"Deployment\",\"metadata\":{\"annotations\":{\"wechat\":\"wen\"},\"labels\":{\"app\":\"netshoot\"},\"name\":\"netshoot\",\"namespace\":\"default\"},\"spec\":{\"replicas\":1,\"selector\":{\"matchLabels\":{\"app\":\"netshoot\"}},\"template\":{\"metadata\":{\"labels\":{\"app\":\"netshoot\"}},\"spec\":{\"containers\":[{\"command\":[\"/bin/sh\",\"-c\",\"echo hello \\u003e\\u00262; echo hello1; sleep 100000\"],\"image\":\"nicolaka/netshoot\",\"name\":\"netshoot\"}],\"nodeSelector\":{\"func\":\"monitor\"},\"tolerations\":[{\"operator\":\"Exists\"}]}}}}\n","wechat":"wen"},"clusterName":""},"spec":{"replicas":1,"selector":{"matchLabels":{"app":"netshoot"}},"template":{"metadata":{"name":"","generateName":"","namespace":"","selfLink":"","uid":"","resourceVersion":"","generation":0,"creationTimestamp":"1970-01-01T08:00:00+08:00","labels":{"app":"netshoot"},"clusterName":""},"spec":{"containers":[{"name":"netshoot","image":"nicolaka/netshoot","command":["/bin/sh","-c","echo hello \u003e\u00262; echo hello1; sleep 100000"],"workingDir":"","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"Always","stdin":false,"stdinOnce":false,"tty":false}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirst","nodeSelector":{"func":"monitor"},"serviceAccountName":"","serviceAccount":"","nodeName":"","hostNetwork":false,"hostPID":false,"hostIPC":false,"securityContext":{},"hostname":"","subdomain":"","schedulerName":"default-scheduler","tolerations":[{"key":"","operator":"Exists","value":"","effect":""}],"priorityClassName":""}},"strategy":{"type":"RollingUpdate","rollingUpdate":{"maxUnavailable":{"type":1,"intVal":0,"strVal":"25%"},"maxSurge":{"type":1,"intVal":0,"strVal":"25%"}}},"minReadySeconds":0,"revisionHistoryLimit":10,"paused":false,"progressDeadlineSeconds":600},"status":{"observedGeneration":1,"replicas":0,"updatedReplicas":0,"readyReplicas":0,"availableReplicas":0,"unavailableReplicas":1,"conditions":[{"type":"Progressing","status":"True","lastUpdateTime":"2019-04-04T14:42:56+08:00","lastTransitionTime":"2019-04-04T14:42:56+08:00","reason":"NewReplicaSetCreated","message":"Created new replica set \"netshoot-757c55d9b8\""},{"type":"Available","status":"False","lastUpdateTime":"2019-04-04T14:42:56+08:00","lastTransitionTime":"2019-04-04T14:42:56+08:00","reason":"MinimumReplicasUnavailable","message":"Deployment does not have minimum availability."}]}}2019/04/04 14:42:55 ignore normal event
2019/04/04 14:42:55 ignore normal event
deployType:  MODIFIED
json: {"metadata":{"name":"netshoot","generateName":"","namespace":"default","selfLink":"/apis/extensions/v1beta1/namespaces/default/deployments/netshoot","uid":"e1058357-56a4-11e9-8fd4-1e5e900bfc2b","resourceVersion":"68267679","generation":1,"creationTimestamp":"2019-04-04T14:42:56+08:00","labels":{"app":"netshoot"},"annotations":{"deployment.kubernetes.io/revision":"1","kubectl.kubernetes.io/last-applied-configuration":"{\"apiVersion\":\"apps/v1\",\"kind\":\"Deployment\",\"metadata\":{\"annotations\":{\"wechat\":\"wen\"},\"labels\":{\"app\":\"netshoot\"},\"name\":\"netshoot\",\"namespace\":\"default\"},\"spec\":{\"replicas\":1,\"selector\":{\"matchLabels\":{\"app\":\"netshoot\"}},\"template\":{\"metadata\":{\"labels\":{\"app\":\"netshoot\"}},\"spec\":{\"containers\":[{\"command\":[\"/bin/sh\",\"-c\",\"echo hello \\u003e\\u00262; echo hello1; sleep 100000\"],\"image\":\"nicolaka/netshoot\",\"name\":\"netshoot\"}],\"nodeSelector\":{\"func\":\"monitor\"},\"tolerations\":[{\"operator\":\"Exists\"}]}}}}\n","wechat":"wen"},"clusterName":""},"spec":{"replicas":1,"selector":{"matchLabels":{"app":"netshoot"}},"template":{"metadata":{"name":"","generateName":"","namespace":"","selfLink":"","uid":"","resourceVersion":"","generation":0,"creationTimestamp":"1970-01-01T08:00:00+08:00","labels":{"app":"netshoot"},"clusterName":""},"spec":{"containers":[{"name":"netshoot","image":"nicolaka/netshoot","command":["/bin/sh","-c","echo hello \u003e\u00262; echo hello1; sleep 100000"],"workingDir":"","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"Always","stdin":false,"stdinOnce":false,"tty":false}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirst","nodeSelector":{"func":"monitor"},"serviceAccountName":"","serviceAccount":"","nodeName":"","hostNetwork":false,"hostPID":false,"hostIPC":false,"securityContext":{},"hostname":"","subdomain":"","schedulerName":"default-scheduler","tolerations":[{"key":"","operator":"Exists","value":"","effect":""}],"priorityClassName":""}},"strategy":{"type":"RollingUpdate","rollingUpdate":{"maxUnavailable":{"type":1,"intVal":0,"strVal":"25%"},"maxSurge":{"type":1,"intVal":0,"strVal":"25%"}}},"minReadySeconds":0,"revisionHistoryLimit":10,"paused":false,"progressDeadlineSeconds":600},"status":{"observedGeneration":1,"replicas":1,"updatedReplicas":1,"readyReplicas":0,"availableReplicas":0,"unavailableReplicas":1,"conditions":[{"type":"Available","status":"False","lastUpdateTime":"2019-04-04T14:42:56+08:00","lastTransitionTime":"2019-04-04T14:42:56+08:00","reason":"MinimumReplicasUnavailable","message":"Deployment does not have minimum availability."},{"type":"Progressing","status":"True","lastUpdateTime":"2019-04-04T14:42:56+08:00","lastTransitionTime":"2019-04-04T14:42:56+08:00","reason":"ReplicaSetUpdated","message":"ReplicaSet \"netshoot-757c55d9b8\" is progressing."}]}}2019/04/04 14:42:55 ignore normal event
2019/04/04 14:42:56 ignore normal event
2019/04/04 14:42:57 ignore normal event
2019/04/04 14:42:57 ignore normal event
2019/04/04 14:42:58 ignore normal event
deployType:  MODIFIED
json: {"metadata":{"name":"netshoot","generateName":"","namespace":"default","selfLink":"/apis/extensions/v1beta1/namespaces/default/deployments/netshoot","uid":"e1058357-56a4-11e9-8fd4-1e5e900bfc2b","resourceVersion":"68267692","generation":1,"creationTimestamp":"2019-04-04T14:42:56+08:00","labels":{"app":"netshoot"},"annotations":{"deployment.kubernetes.io/revision":"1","kubectl.kubernetes.io/last-applied-configuration":"{\"apiVersion\":\"apps/v1\",\"kind\":\"Deployment\",\"metadata\":{\"annotations\":{\"wechat\":\"wen\"},\"labels\":{\"app\":\"netshoot\"},\"name\":\"netshoot\",\"namespace\":\"default\"},\"spec\":{\"replicas\":1,\"selector\":{\"matchLabels\":{\"app\":\"netshoot\"}},\"template\":{\"metadata\":{\"labels\":{\"app\":\"netshoot\"}},\"spec\":{\"containers\":[{\"command\":[\"/bin/sh\",\"-c\",\"echo hello \\u003e\\u00262; echo hello1; sleep 100000\"],\"image\":\"nicolaka/netshoot\",\"name\":\"netshoot\"}],\"nodeSelector\":{\"func\":\"monitor\"},\"tolerations\":[{\"operator\":\"Exists\"}]}}}}\n","wechat":"wen"},"clusterName":""},"spec":{"replicas":1,"selector":{"matchLabels":{"app":"netshoot"}},"template":{"metadata":{"name":"","generateName":"","namespace":"","selfLink":"","uid":"","resourceVersion":"","generation":0,"creationTimestamp":"1970-01-01T08:00:00+08:00","labels":{"app":"netshoot"},"clusterName":""},"spec":{"containers":[{"name":"netshoot","image":"nicolaka/netshoot","command":["/bin/sh","-c","echo hello \u003e\u00262; echo hello1; sleep 100000"],"workingDir":"","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"Always","stdin":false,"stdinOnce":false,"tty":false}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirst","nodeSelector":{"func":"monitor"},"serviceAccountName":"","serviceAccount":"","nodeName":"","hostNetwork":false,"hostPID":false,"hostIPC":false,"securityContext":{},"hostname":"","subdomain":"","schedulerName":"default-scheduler","tolerations":[{"key":"","operator":"Exists","value":"","effect":""}],"priorityClassName":""}},"strategy":{"type":"RollingUpdate","rollingUpdate":{"maxUnavailable":{"type":1,"intVal":0,"strVal":"25%"},"maxSurge":{"type":1,"intVal":0,"strVal":"25%"}}},"minReadySeconds":0,"revisionHistoryLimit":10,"paused":false,"progressDeadlineSeconds":600},"status":{"observedGeneration":1,"replicas":1,"updatedReplicas":1,"readyReplicas":1,"availableReplicas":1,"unavailableReplicas":0,"conditions":[{"type":"Available","status":"True","lastUpdateTime":"2019-04-04T14:42:59+08:00","lastTransitionTime":"2019-04-04T14:42:59+08:00","reason":"MinimumReplicasAvailable","message":"Deployment has minimum availability."},{"type":"Progressing","status":"True","lastUpdateTime":"2019-04-04T14:42:59+08:00","lastTransitionTime":"2019-04-04T14:42:56+08:00","reason":"NewReplicaSetAvailable","message":"ReplicaSet \"netshoot-757c55d9b8\" has successfully progressed."}]}}
`
